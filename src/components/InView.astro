---
interface Props {
  amount?: number;
  once?: boolean;
}

const { amount = 0.3, once = false } = Astro.props;
---

<in-view data-amount={amount} data-once={once}>
  <slot />
</in-view>

<script>
  import { inView } from "motion";

  class InView extends HTMLElement {
    constructor() {
      super();

      const amount = Number.parseFloat(this.dataset.amount as string);
      const once = this.dataset.once === "true";

      inView(
        this,
        () => {
          this.setAttribute("data-in-view", "");

          return () => {
            if (!once) {
              this.removeAttribute("data-in-view");
            }
          };
        },
        { amount },
      );
    }
  }

  customElements.define("in-view", InView);
</script>
